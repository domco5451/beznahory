---
import GpxDownload from "./GpxDownload.astro";
import MapButton from "./MapButton.astro";
import Ratings from "./Ratings.astro";
import GpxMap from "./GpxMap.astro";

const { frontmatter } = Astro.props;
---

<div class="container">
  <div class="tura-beh">
    <span class="tura-button active">Túra</span>
    { frontmatter.gpx && <span class="beh-button">Beh</span>}
  </div>
  { frontmatter.gpx && 
  <div class="beh-content">
    <GpxMap {frontmatter} />
    <GpxDownload {frontmatter} />
  </div>
  }
  <div class="tura-content">
    <Ratings {frontmatter} />
    <MapButton />
  </div>
</div>
<style>
  .container {
    height: fit-content;
    border-radius: 15px;

  }
  .tura-beh {
    display: flex;
    justify-content: space-around;
    align-items: center
    color: var(--primary-text);
    gap: 5px;
  }
  .tura-beh span {
    font-size: 1.2rem;
    cursor: pointer;
    padding: 10px;
    border: 1px solid rgb(233, 233, 233);
    width: 100%;
    text-align: center;
    border-radius: 10px;
    margin-block-end: 10px;
  }
  .tura-beh span:hover {
    background-color: var(--hover-bg);
  }
  .tura-beh span.active {
    background: var(--hover-bg)
  }
  .beh-content {
    display: none;
  }
  .tura-content {
    display: block;
  }
</style>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Získaj referencie na elementy
    const beh = document.querySelector(".beh-content");
    const tura = document.querySelector(".tura-content");
    const behButton = document.querySelector(".beh-button");
    const turaButton = document.querySelector(".tura-button");

    // Funkcia pre zobrazenie behu - s kontrolou existencie elementov
    const showBeh = () => {
      if (!beh || !tura || !behButton || !turaButton) return;
      
      beh.style.display = "block";
      tura.style.display = "none";
      behButton.classList.add("active");
      turaButton.classList.remove("active");
      document.dispatchEvent(new CustomEvent("gpx:show"));
    };

    // Funkcia pre zobrazenie túry - s kontrolou existencie elementov
    const showTura = () => {
      if (!tura) return;
      
      // Ak beh neexistuje, len skryjeme túru a nastavíme tlačidlo
      if (beh) beh.style.display = "none";
      tura.style.display = "block";
      
      if (behButton) behButton.classList.remove("active");
      if (turaButton) turaButton.classList.add("active");
      
      // Odošli event pre refreshnutie mapy, ak má zmysel
      if (beh) document.dispatchEvent(new CustomEvent("gpx:show"));
    };

    // Pripoj event listenery, iba ak existujú tlačidlá
    if (behButton) behButton.addEventListener("click", showBeh);
    if (turaButton) turaButton.addEventListener("click", showTura);
    
    // Nastav predvolenú záložku - ak GPX existuje, ukáž túru, inak nič
    if (tura) {
      // Ak GPX existuje, tak na začiatku dispatchneme event pre mapu
      if (beh) document.dispatchEvent(new CustomEvent('gpx:show'));
    }
  });
</script>