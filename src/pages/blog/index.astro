---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import PageLayout from "../../layouts/PageLayout.astro";

const allPosts = await getCollection("blog");

const postsWithReadingTime = await Promise.all(
  allPosts.map(async (post) => {
    const { remarkPluginFrontmatter } = await post.render();
    return {
      ...post,
      minutesRead: remarkPluginFrontmatter.minutesRead
    };
  })
);

---
{/* Dorobiť Image nech nie je nad header */}
<PageLayout title="Blog">
  <div class="blog-header">
    <div class="blog-wrapper">
      <div>
        <h1>Blog</h1>
        <h2>Moje príbehy z behu na horách</h2>
      </div>
      <Icon name="blog" size={200}/>
    </div>
  </div>
  <div class="container">
    <section class="main-grid">
      {
        postsWithReadingTime.map((post: any, i: number) => (
          <article class="wrapper">
            <a href={`/blog/${post.slug}`}>
              <Image
                  class="thumbnail"
                  src={post.data.thumbnail}
                  alt={post.data.thumbnailAlt}
                  loading={i < 4 ? "eager" : "lazy"}
                />
            </a>
            <div class="content-wrapper">
              <header class="header-blog">
                <h2><a href={`/blog/${post.slug}`}>{post.data.title}</a></h2>
                <p>{post.minutesRead}</p>
              </header>
                <p class="description">{post.data.description}</p>
                <footer class="wrapper-flex">
                  <div class="author-flex">
                    <Image
                      class="pfp"
                      width={50}
                      src={post.data.pfp}
                      alt={post.data.pfpAlt}
                      loading={i < 2 ? "eager" : "lazy"}
                    />
                    <div>
                      <p><strong>{post.data.author}</strong></p>
                      <p>{post.data.pubDate.toLocaleDateString()}</p>
                    </div>
                  </div>
                  <a class="cursor-flex" href={`/blog/${post.slug}`}>
                    <span>Čítať ďalej</span>
                    <Icon class="cursor" name="cursor" size={15} />
                  </a>
                  </footer>
            </div>
          </article>
        ))
      }
    </section>
  </div>
</PageLayout>
{/* <a href="https://www.svgbackgrounds.com/set/free-svg-backgrounds-and-patterns/">Free SVG Backgrounds and Patterns by SVGBackgrounds.com</a> */}
<style>
.container {
  max-width: 1400px;
  margin: 50px auto;
}
.blog-header h1 {
  font-size: 4rem;
  font-weight: bolder;
}
.blog-header h2 {
  font-size: 1.5rem;
}
.blog-header {
  background-image: url("../../icons/pozadieAbout.svg");
  background-size: cover;
  padding-inline: 20%;
  padding-block: 35px;
}
.blog-wrapper {
  max-width: 1200px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.cursor {
  margin-left: 5px;
  fill: var(--bg-primary);
  transition: transform 0.2s ease-in-out;
}
header h2 {
  color: blue;
  margin-block-end: 15px;
}
header h2 a {
  text-decoration: none;
  font-weight: 500;
  font-size: 1.8rem;
}
header h2 a:hover {
  text-decoration: underline;
}
.wrapper {
    border-radius: 15px;
    border: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
}
.main-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}
.thumbnail {
    max-width: 100%;
    height: 300px;
    border-radius: 13px 13px 0 0;
    object-fit: cover;
}
.author-flex {
    display: flex;
    align-items: center;
    gap: 15px;
}
.wrapper-flex {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-block-start: 15px;
}
.description {
  line-height: 1.8;
}
.pfp {
    width: 50px;
    height: 50px;
    object-fit: cover;
    border-radius: 100%;
}
.cursor-flex {
    display: flex;
    align-items: center;
    background: var(--text-primary);
    padding: 8px;
    color: var(--bg-primary);
    text-decoration: none;
    border-radius: 5px;
}
.cursor-flex:hover {
  background-color: var(--hover-bg-secondary-2);
}
.cursor-flex:hover .cursor {
  transform: scale(1.3);
}
.content-wrapper {
  padding: 30px;
  display: flex;
  flex-direction: column;
  gap: 15px;
  justify-content: space-between;
  flex: 1;
}
.header-blog p {
  font-weight: 500;
}
.filter-flex {
    display: flex;
    gap: 5px;
    align-items: center;
}
.filter-flex svg {
    width: 35px;
}
.margin-nadpis {
    margin-bottom: 15px;
}
.margin-nadpis h3 {
    font-weight: 300;
}
@media (max-width: 768px) {
    .main-grid {
      grid-template-columns: 1fr;
      padding: 15px;
    }
}
</style>
