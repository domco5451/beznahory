---
import { getCollection } from "astro:content";
import HikeLayout from "./index.astro";
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const allPosts = await getCollection("blog");

  const sortedPosts = allPosts.sort((a, b) => {
    const dateA = new Date(a.data.pubDate);
    const dateB = new Date(b.data.pubDate);
    return dateB.getTime() - dateA.getTime();
  });
  {
    return [
      { params: { kraj: "bratislavsky-kraj" }, props: { posts: sortedPosts } },
      { params: { kraj: "trnavsky-kraj" }, props: { posts: sortedPosts } },
      { params: { kraj: "trenciansky-kraj" }, props: { posts: sortedPosts } },
      { params: { kraj: "nitriansky-kraj" }, props: { posts: sortedPosts } },
      { params: { kraj: "zilinsky-kraj" }, props: { posts: sortedPosts } },
      { params: { kraj: "banskobystricky-kraj" }, props: { posts: sortedPosts } },
      { params: { kraj: "presovsky-kraj" }, props: { posts: sortedPosts } },
      { params: { kraj: "kosicky-kraj" }, props: { posts: sortedPosts } },
    ];
  }
}

const { kraj } = Astro.params;
const { posts } = Astro.props;
const filteredPosts = posts.filter((post: any) =>
  post.data.kraj?.includes(kraj)
);
---

<HikeLayout title={kraj}>
  {
    filteredPosts.length === 0 ? (
      <div class="no-posts">
          <Icon class="icon" name="odoInfo" size={30}/>
          <p>Zatiaľ žiadne príspevky</p>
        </div>
    ) : null
  }
  <div class="grid-container">
    {
      filteredPosts.map((post: any) => (
        <a href={`/blog/${post.slug}`}>
          <div>
            <Image
              class="thumbnail"
              src={post.data.thumbnail}
              alt={post.data.thumbnailAlt}
              inferSize={true}
              layout="constrained"
              loading="eager"
            />
            <div class="post-info-wrapper">
              <h2>{post.data.title}</h2>
              <div class="icon-info">
                <Icon
                  style="margin-block: 15px"
                  class="gps"
                  name="gps2"
                  size={20}
                />
                <h3>{post.data.okres}</h3>
              </div>
              <div class="author-info">
                <div class="icon-info">
                  <Icon name="person" size={20} />
                  <p>{post.data.author}</p>
                </div>
                <div class="icon-info">
                  <Icon name="date" size={20} />
                  <p>
                    {new Date(post.data.pubDate).toLocaleDateString("sk-SK", {
                      year: "numeric",
                      month: "long",
                      day: "numeric",
                    })}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </a>
      ))
    }
  </div>
</HikeLayout>
<style>
  code {
    display: inline-block;
    margin-inline: 5px;
    background:
      linear-gradient(66.77deg, #e6f0ff 0%, #f5f9ff 100%) padding-box,
      linear-gradient(155deg, #003fcc 0%, #0055ff 40%, #66a3ff 80%) border-box;
    border-radius: 8px;
    border: 1px solid transparent;
    padding: 15px 8px;
  }
  .kraj-selector {
    margin-block: 30px;
  }
  .grid-container {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 20px;
    margin-block-start: 20px;
  }
  .grid-container a {
    border-radius: 11px;
    border: 1px solid var(--border-color);
    transition: transform 0.2s ease-in-out;
  }
  .grid-container a:hover {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transform: translateY(-5px);
  }
  .thumbnail {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 10px 10px 0 0;
  }
  .post-info-wrapper {
    padding: 10px;
  }
  .post-info-wrapper h2 {
    font-weight: bold;
    font-size: 1.1rem;
  }
  .post-info-wrapper h3 {
    font-weight: 300;
    font-size: 1rem;
  }
  .author-info {
    display: flex;
    justify-content: space-between;
    color: var(--text-color);
  }
  .no-posts {
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: center;
    padding: 10px;
    background: #172238;
    border-radius: 10px;
    width: 100%;
    color: white;
    font-size: 1.2rem;
    margin-top: 20px;
  }
  .icon {
    color: #f7c948;
  }
  .icon-info {
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .filter {
    color: var(--heading-text);
    text-decoration: underline;
  }
  .empty {
    margin-block: 20px;
    text-align: center;
    font-size: 1.2rem;
    color: var(--text-color);
    padding: 10px;
  }
  .gps {
    color: var(--heading-text);
  }
  @media (max-width: 1300px) {
    .grid-container {
      grid-template-columns: 1fr 1fr 1fr;
    }
  }
  @media (max-width: 1000px) {
    .grid-container {
      grid-template-columns: 1fr 1fr;
    }
  }
  @media (max-width: 675px) {
    .grid-container {
      grid-template-columns: 1fr;
    }
  }
</style>
