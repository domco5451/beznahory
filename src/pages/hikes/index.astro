---
import { getCollection } from "astro:content";
import PageLayout from "../../layouts/PageLayout.astro";
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";

const currentPath = Astro.url.pathname;

const allPosts = await getCollection("blog", ({ data }) => {
  return data.type === "tura";
});
console.log(allPosts);

const kraje = [
  { href: "/hikes/bratislavsky-kraj", kraj: "Bratislavský kraj" },
  { href: "/hikes/trnavsky-kraj", kraj: "Trnavský kraj" },
  { href: "/hikes/trenciansky-kraj", kraj: "Trenčiansky kraj" },
  { href: "/hikes/nitriansky-kraj", kraj: "Nitriansky kraj" },
  { href: "/hikes/zilinsky-kraj", kraj: "Žilinský kraj" },
  { href: "/hikes/banskobystricky-kraj", kraj: "Banskobystrický kraj" },
  { href: "/hikes/presovsky-kraj", kraj: "Prešovský kraj" },
  { href: "/hikes/kosicky-kraj", kraj: "Košický kraj" },
];
---

<PageLayout title="Túry">
  <div class="blog-header">
    <div class="blog-wrapper">
      <div>
        <h1>Turistika</h1>
        <h2>Filtrujte blog príspevky podľa kraja</h2>
      </div>
      <Icon name="mountain" size={200} />
    </div>
  </div>
  <div class="container">
    <div class="kraje">
      {
        kraje.map((kraj: any) => (
          <a href={kraj.href} class:list={["badge", currentPath === kraj.href && "badge-active"]}>
            <Icon class="gpsIcon" name="gps2"/>
            <span>{kraj.kraj}</span>
          </a>
        ))
      }
    </div>
    {
      allPosts.length === 0 && Astro.url.pathname === "/hikes" ? (
        <p style="margin-block: 20px">Zatial žiadne príspevky.</p>
      ) : null
    }
    {
      currentPath === "/hikes" && (
        <div class="grid-container-hikes">
          {allPosts.map((post: any) => (
            <a href={`/blog/${post.slug}`}>
              <div>
                <Image
                  class="thumbnail"
                  src={post.data.thumbnail}
                  alt={post.data.thumbnailAlt}
                  inferSize={true}
                  layout="constrained"
                  loading="eager"
                />
                <div class="post-info-wrapper">
                  <h2>{post.data.title}</h2>
                  <div style="margin-block: 15px" class="icon-info">
                    <Icon class="gps" name="gps2" size={20} />
                    <h3>{post.data.okres}</h3>
                  </div>
                  <div class="author-info">
                    <div class="icon-info">
                      <Icon name="person" size={20} />
                      <p>{post.data.author}</p>
                    </div>
                    <div class="icon-info">
                      <Icon name="date" size={20} />
                      <p>{new Date(post.data.pubDate).toLocaleDateString("sk-SK", { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    </div>
                  </div>
                </div>
              </div>
            </a>
          ))}
        </div>
      )
    }
    <slot />
  </div>
</PageLayout>
<style>
  .main-p {
    font-size: 1.1rem;
    margin-block-end: 20px;
    color: var(--text-color);
  }
  .container {
    max-width: 1300px;
    margin: 40px auto;
  }
  .kraje {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .blog-header h1 {
    font-size: 4rem;
    font-weight: bolder;
  }
  .blog-header h2 {
    font-size: 1.5rem;
  }
  .blog-header {
    background-image: url("../../icons/pozadieAbout.svg");
    background-size: cover;
    padding-inline: 20%;
    padding-block: 35px;
  }
  .blog-wrapper {
    max-width: 1200px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  /* Kraj Default */

  .kraj-selector {
    margin-block: 10px;
  }
  .grid-container-hikes {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 20px;
    margin-block-start: 20px;
  }
  .grid-container-hikes a {
    border-radius: 10px;
    border: 1px solid var(--border-color);
    transition: transform 0.2s ease-in-out;
  }
  .grid-container-hikes a:hover {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transform: translateY(-5px);
  }
  .thumbnail {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 8px 8px 0 0;
  }
  .post-info-wrapper {
    padding: 10px;
  }
  .post-info-wrapper h2 {
    font-weight: bold;
    font-size: 1.1rem;
  }
  .post-info-wrapper h3 {
    font-weight: 300;
    font-size: 1rem;
  }
  .author-info {
    display: flex;
    justify-content: space-between;
    color: var(--text-color);
  }
  .icon-info {
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .gps {
    color: var(--heading-text);
  }
  /* Badge */
  .badge {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 10px;
    background: var(--heading-text);
    color: white;
    width: fit-content;
    border-radius: 10px;
  }
  .badge:hover {
    background: rgb(45, 118, 255);
  }
  .badge-active {
    background: #172238;
  }
  .badge-active .gpsIcon {
    color: rgb(55, 255, 55);
  }
  .badge-active:hover {
    background: #172238;
  }
</style>
<script>
  // Ked kliknem na badge ktora je aktivna, tak ma to presmeruje na /hikes
  document.querySelectorAll(".badge").forEach((badge) => {
    badge.addEventListener("click", (e) => {
      if (badge.classList.contains("badge-active")) {
        e.preventDefault();
        window.location.href = "/hikes";
      }
    });
  });
</script>